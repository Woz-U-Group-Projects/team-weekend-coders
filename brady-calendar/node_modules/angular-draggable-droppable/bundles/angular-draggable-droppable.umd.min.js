!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs"),require("@angular/core"),require("rxjs/operators"),require("@angular/common")):"function"==typeof define&&define.amd?define("angular-draggable-droppable",["exports","rxjs","@angular/core","rxjs/operators","@angular/common"],t):t(e["angular-draggable-droppable"]={},e.rxjs,e.ng.core,e.rxjs.operators,e.ng.common)}(this,function(e,a,l,d,t){"use strict";var h=function(){return(h=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function m(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||0<t--)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return s}var n=function(){function e(){this.currentDrag=new a.Subject}return e.decorators=[{type:l.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=l.defineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}(),r=function(){function e(e,t,n){this.elementRef=e,this.renderer=t,this.zone=n,this.activeLongPressDrag=!1,this.longPressConfig={duration:300,delta:30},this.cancelledScroll=!1}return e.prototype.ngOnInit=function(){var t=this;this.zone.runOutsideAngular(function(){t.renderer.listen(t.elementRef.nativeElement,"touchmove",function(e){t.cancelledScroll&&e.cancelable&&e.preventDefault()})})},e.prototype.disableScroll=function(){this.cancelledScroll=!0,this.renderer.setStyle(this.elementRef.nativeElement,"overflow","hidden")},e.prototype.enableScroll=function(){this.cancelledScroll=!1,this.renderer.setStyle(this.elementRef.nativeElement,"overflow","auto")},e.prototype.hasScrollbar=function(){var e=0<this.elementRef.nativeElement.scrollWidth-this.elementRef.nativeElement.clientWidth,t=0<this.elementRef.nativeElement.scrollHeight-this.elementRef.nativeElement.clientHeight;return e||t},e.decorators=[{type:l.Directive,args:[{selector:"[mwlDraggableScrollContainer]"}]}],e.ctorParameters=function(){return[{type:l.ElementRef},{type:l.Renderer2},{type:l.NgZone}]},e.propDecorators={activeLongPressDrag:[{type:l.Input}],longPressConfig:[{type:l.Input}]},e}(),i=function(){function e(e,t,n,r,i,o,s){this.element=e,this.renderer=t,this.draggableHelper=n,this.zone=r,this.vcr=i,this.scrollContainer=o,this.document=s,this.dragAxis={x:!0,y:!0},this.dragSnapGrid={},this.ghostDragEnabled=!0,this.showOriginalElementWhileDragging=!1,this.dragCursor="",this.dragPointerDown=new l.EventEmitter,this.dragStart=new l.EventEmitter,this.ghostElementCreated=new l.EventEmitter,this.dragging=new l.EventEmitter,this.dragEnd=new l.EventEmitter,this.pointerDown$=new a.Subject,this.pointerMove$=new a.Subject,this.pointerUp$=new a.Subject,this.eventListenerSubscriptions={},this.destroy$=new a.Subject,this.timeLongPress={timerBegin:0,timerEnd:0}}return e.prototype.ngOnInit=function(){var p=this;this.checkEventListeners();var e=this.pointerDown$.pipe(d.filter(function(){return p.canDrag()}),d.mergeMap(function(i){i.event.stopPropagation&&!p.scrollContainer&&i.event.stopPropagation();var e=p.renderer.createElement("style");p.renderer.setAttribute(e,"type","text/css"),p.renderer.appendChild(e,p.renderer.createText("\n          body * {\n           -moz-user-select: none;\n           -ms-user-select: none;\n           -webkit-user-select: none;\n           user-select: none;\n          }\n        ")),p.document.head.appendChild(e);var r=p.getScrollPosition(),t=new a.Observable(function(t){var e=p.scrollContainer?p.scrollContainer.elementRef.nativeElement:"window";return p.renderer.listen(e,"scroll",function(e){return t.next(e)})}).pipe(d.startWith(r),d.map(function(){return p.getScrollPosition()})),l=new a.Subject,c=new a.ReplaySubject;p.zone.run(function(){p.dragPointerDown.next({x:0,y:0})});var n=a.merge(p.pointerUp$,p.pointerDown$,c,p.destroy$).pipe(d.share()),o=a.combineLatest(p.pointerMove$,t).pipe(d.map(function(e){var t=m(e,2),n=t[0],r=t[1];return{currentDrag$:l,transformX:n.clientX-i.clientX,transformY:n.clientY-i.clientY,clientX:n.clientX,clientY:n.clientY,scrollLeft:r.left,scrollTop:r.top}}),d.map(function(e){return p.dragSnapGrid.x&&(e.transformX=Math.round(e.transformX/p.dragSnapGrid.x)*p.dragSnapGrid.x),p.dragSnapGrid.y&&(e.transformY=Math.round(e.transformY/p.dragSnapGrid.y)*p.dragSnapGrid.y),e}),d.map(function(e){return p.dragAxis.x||(e.transformX=0),p.dragAxis.y||(e.transformY=0),e}),d.map(function(e){var t=e.scrollLeft-r.left,n=e.scrollTop-r.top;return h({},e,{x:e.transformX+t,y:e.transformY+n})}),d.filter(function(e){var t=e.x,n=e.y;return!p.validateDrag||p.validateDrag({x:t,y:n})}),d.takeUntil(n),d.share()),s=o.pipe(d.take(1),d.share()),u=o.pipe(d.takeLast(1),d.share());return s.subscribe(function(e){var t=e.clientX,n=e.clientY,r=e.x,i=e.y;if(p.zone.run(function(){p.dragStart.next({cancelDrag$:c})}),p.renderer.addClass(p.element.nativeElement,p.dragActiveClass),p.ghostDragEnabled){var o=p.element.nativeElement.getBoundingClientRect(),s=p.element.nativeElement.cloneNode(!0);if(p.showOriginalElementWhileDragging||p.renderer.setStyle(p.element.nativeElement,"visibility","hidden"),p.ghostElementAppendTo?p.ghostElementAppendTo.appendChild(s):p.element.nativeElement.parentNode.insertBefore(s,p.element.nativeElement.nextSibling),p.ghostElement=s,p.setElementStyles(s,{position:"fixed",top:o.top+"px",left:o.left+"px",width:o.width+"px",height:o.height+"px",cursor:p.dragCursor,margin:"0"}),p.ghostElementTemplate){var a=p.vcr.createEmbeddedView(p.ghostElementTemplate);s.innerHTML="",a.rootNodes.filter(function(e){return e instanceof Node}).forEach(function(e){s.appendChild(e)}),u.subscribe(function(){p.vcr.remove(p.vcr.indexOf(a))})}p.zone.run(function(){p.ghostElementCreated.emit({clientX:t-r,clientY:n-i,element:s})}),u.subscribe(function(){s.parentElement.removeChild(s),p.ghostElement=null,p.renderer.setStyle(p.element.nativeElement,"visibility","")})}p.draggableHelper.currentDrag.next(l)}),u.pipe(d.mergeMap(function(t){var e=c.pipe(d.count(),d.take(1),d.map(function(e){return h({},t,{dragCancelled:0<e})}));return c.complete(),e})).subscribe(function(e){var t=e.x,n=e.y,r=e.dragCancelled;p.zone.run(function(){p.dragEnd.next({x:t,y:n,dragCancelled:r})}),p.renderer.removeClass(p.element.nativeElement,p.dragActiveClass),l.complete()}),a.merge(n,u).pipe(d.take(1)).subscribe(function(){p.document.head.removeChild(e)}),o}),d.share());a.merge(e.pipe(d.take(1),d.map(function(e){return[,e]})),e.pipe(d.pairwise())).pipe(d.filter(function(e){var t=m(e,2),n=t[0],r=t[1];return!n||(n.x!==r.x||n.y!==r.y)}),d.map(function(e){var t=m(e,2);t[0];return t[1]})).subscribe(function(e){var t=e.x,n=e.y,r=e.currentDrag$,i=e.clientX,o=e.clientY,s=e.transformX,a=e.transformY;if(p.zone.run(function(){p.dragging.next({x:t,y:n})}),p.ghostElement){var l="translate("+s+"px, "+a+"px)";p.setElementStyles(p.ghostElement,{transform:l,"-webkit-transform":l,"-ms-transform":l,"-moz-transform":l,"-o-transform":l})}r.next({clientX:i,clientY:o,dropData:p.dropData})})},e.prototype.ngOnChanges=function(e){e.dragAxis&&this.checkEventListeners()},e.prototype.ngOnDestroy=function(){this.unsubscribeEventListeners(),this.pointerDown$.complete(),this.pointerMove$.complete(),this.pointerUp$.complete(),this.destroy$.next()},e.prototype.checkEventListeners=function(){var t=this,e=this.canDrag(),n=0<Object.keys(this.eventListenerSubscriptions).length;e&&!n?this.zone.runOutsideAngular(function(){t.eventListenerSubscriptions.mousedown=t.renderer.listen(t.element.nativeElement,"mousedown",function(e){t.onMouseDown(e)}),t.eventListenerSubscriptions.mouseup=t.renderer.listen("document","mouseup",function(e){t.onMouseUp(e)}),t.eventListenerSubscriptions.touchstart=t.renderer.listen(t.element.nativeElement,"touchstart",function(e){t.onTouchStart(e)}),t.eventListenerSubscriptions.touchend=t.renderer.listen("document","touchend",function(e){t.onTouchEnd(e)}),t.eventListenerSubscriptions.touchcancel=t.renderer.listen("document","touchcancel",function(e){t.onTouchEnd(e)}),t.eventListenerSubscriptions.mouseenter=t.renderer.listen(t.element.nativeElement,"mouseenter",function(){t.onMouseEnter()}),t.eventListenerSubscriptions.mouseleave=t.renderer.listen(t.element.nativeElement,"mouseleave",function(){t.onMouseLeave()})}):!e&&n&&this.unsubscribeEventListeners()},e.prototype.onMouseDown=function(e){var t=this;this.eventListenerSubscriptions.mousemove||(this.eventListenerSubscriptions.mousemove=this.renderer.listen("document","mousemove",function(e){t.pointerMove$.next({event:e,clientX:e.clientX,clientY:e.clientY})})),this.pointerDown$.next({event:e,clientX:e.clientX,clientY:e.clientY})},e.prototype.onMouseUp=function(e){this.eventListenerSubscriptions.mousemove&&(this.eventListenerSubscriptions.mousemove(),delete this.eventListenerSubscriptions.mousemove),this.pointerUp$.next({event:e,clientX:e.clientX,clientY:e.clientY})},e.prototype.onTouchStart=function(t){var n,r,i,o=this;if(!this.scrollContainer)try{t.preventDefault()}catch(e){}this.scrollContainer&&this.scrollContainer.activeLongPressDrag&&(this.timeLongPress.timerBegin=Date.now(),i=!1,n=this.scrollContainer.hasScrollbar(),r=this.getScrollPosition()),this.eventListenerSubscriptions.touchmove||(this.eventListenerSubscriptions.touchmove=this.renderer.listen("document","touchmove",function(e){o.scrollContainer&&o.scrollContainer.activeLongPressDrag&&!i&&n&&(i=o.shouldBeginDrag(t,e,r)),o.scrollContainer&&o.scrollContainer.activeLongPressDrag&&n&&!i||o.pointerMove$.next({event:e,clientX:e.targetTouches[0].clientX,clientY:e.targetTouches[0].clientY})})),this.pointerDown$.next({event:t,clientX:t.touches[0].clientX,clientY:t.touches[0].clientY})},e.prototype.onTouchEnd=function(e){this.eventListenerSubscriptions.touchmove&&(this.eventListenerSubscriptions.touchmove(),delete this.eventListenerSubscriptions.touchmove,this.scrollContainer&&this.scrollContainer.activeLongPressDrag&&this.scrollContainer.enableScroll()),this.pointerUp$.next({event:e,clientX:e.changedTouches[0].clientX,clientY:e.changedTouches[0].clientY})},e.prototype.onMouseEnter=function(){this.setCursor(this.dragCursor)},e.prototype.onMouseLeave=function(){this.setCursor("")},e.prototype.canDrag=function(){return this.dragAxis.x||this.dragAxis.y},e.prototype.setCursor=function(e){this.renderer.setStyle(this.element.nativeElement,"cursor",e)},e.prototype.unsubscribeEventListeners=function(){var t=this;Object.keys(this.eventListenerSubscriptions).forEach(function(e){t.eventListenerSubscriptions[e](),delete t.eventListenerSubscriptions[e]})},e.prototype.setElementStyles=function(t,n){var r=this;Object.keys(n).forEach(function(e){r.renderer.setStyle(t,e,n[e])})},e.prototype.getScrollPosition=function(){return this.scrollContainer?{top:this.scrollContainer.elementRef.nativeElement.scrollTop,left:this.scrollContainer.elementRef.nativeElement.scrollLeft}:{top:window.pageYOffset||document.documentElement.scrollTop,left:window.pageXOffset||document.documentElement.scrollLeft}},e.prototype.shouldBeginDrag=function(e,t,n){var r=this.getScrollPosition(),i=Math.abs(r.top-n.top),o=Math.abs(r.left-n.left);return(Math.abs(t.targetTouches[0].clientX-e.touches[0].clientX)-o+(Math.abs(t.targetTouches[0].clientY-e.touches[0].clientY)-i)>this.scrollContainer.longPressConfig.delta||0<i||0<o)&&(this.timeLongPress.timerBegin=Date.now()),this.timeLongPress.timerEnd=Date.now(),this.timeLongPress.timerEnd-this.timeLongPress.timerBegin>=this.scrollContainer.longPressConfig.duration&&(this.scrollContainer.disableScroll(),!0)},e.decorators=[{type:l.Directive,args:[{selector:"[mwlDraggable]"}]}],e.ctorParameters=function(){return[{type:l.ElementRef},{type:l.Renderer2},{type:n},{type:l.NgZone},{type:l.ViewContainerRef},{type:r,decorators:[{type:l.Optional}]},{type:undefined,decorators:[{type:l.Inject,args:[t.DOCUMENT]}]}]},e.propDecorators={dropData:[{type:l.Input}],dragAxis:[{type:l.Input}],dragSnapGrid:[{type:l.Input}],ghostDragEnabled:[{type:l.Input}],showOriginalElementWhileDragging:[{type:l.Input}],validateDrag:[{type:l.Input}],dragCursor:[{type:l.Input}],dragActiveClass:[{type:l.Input}],ghostElementAppendTo:[{type:l.Input}],ghostElementTemplate:[{type:l.Input}],dragPointerDown:[{type:l.Output}],dragStart:[{type:l.Output}],ghostElementCreated:[{type:l.Output}],dragging:[{type:l.Output}],dragEnd:[{type:l.Output}]},e}();function c(e,t,n){return e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom}var o=function(){function e(e,t,n,r,i){this.element=e,this.draggableHelper=t,this.zone=n,this.renderer=r,this.scrollContainer=i,this.dragEnter=new l.EventEmitter,this.dragLeave=new l.EventEmitter,this.dragOver=new l.EventEmitter,this.drop=new l.EventEmitter}return e.prototype.ngOnInit=function(){var a=this;this.currentDragSubscription=this.draggableHelper.currentDrag.subscribe(function(e){a.renderer.addClass(a.element.nativeElement,a.dragActiveClass);var o,t,s={updateCache:!0},n=a.renderer.listen(a.scrollContainer?a.scrollContainer.elementRef.nativeElement:"window","scroll",function(){s.updateCache=!0}),r=e.pipe(d.map(function(e){var t=e.clientX,n=e.clientY,r=e.dropData;o=r,s.updateCache&&(s.rect=a.element.nativeElement.getBoundingClientRect(),a.scrollContainer&&(s.scrollContainerRect=a.scrollContainer.elementRef.nativeElement.getBoundingClientRect()),s.updateCache=!1);var i=c(t,n,s.rect);return s.scrollContainerRect?i&&c(t,n,s.scrollContainerRect):i})),i=r.pipe(d.distinctUntilChanged());i.pipe(d.filter(function(e){return e})).subscribe(function(){t=!0,a.renderer.addClass(a.element.nativeElement,a.dragOverClass),a.zone.run(function(){a.dragEnter.next({dropData:o})})}),r.pipe(d.filter(function(e){return e})).subscribe(function(){a.zone.run(function(){a.dragOver.next({dropData:o})})}),i.pipe(d.pairwise(),d.filter(function(e){var t=m(e,2),n=t[0],r=t[1];return n&&!r})).subscribe(function(){t=!1,a.renderer.removeClass(a.element.nativeElement,a.dragOverClass),a.zone.run(function(){a.dragLeave.next({dropData:o})})}),e.subscribe({complete:function(){n(),a.renderer.removeClass(a.element.nativeElement,a.dragActiveClass),t&&(a.renderer.removeClass(a.element.nativeElement,a.dragOverClass),a.zone.run(function(){a.drop.next({dropData:o})}))}})})},e.prototype.ngOnDestroy=function(){this.currentDragSubscription&&this.currentDragSubscription.unsubscribe()},e.decorators=[{type:l.Directive,args:[{selector:"[mwlDroppable]"}]}],e.ctorParameters=function(){return[{type:l.ElementRef},{type:n},{type:l.NgZone},{type:l.Renderer2},{type:r,decorators:[{type:l.Optional}]}]},e.propDecorators={dragOverClass:[{type:l.Input}],dragActiveClass:[{type:l.Input}],dragEnter:[{type:l.Output}],dragLeave:[{type:l.Output}],dragOver:[{type:l.Output}],drop:[{type:l.Output}]},e}(),s=function(){function e(){}return e.decorators=[{type:l.NgModule,args:[{declarations:[i,o,r],exports:[i,o,r]}]}],e}();e.DragAndDropModule=s,e.ɵc=n,e.ɵd=r,e.ɵb=i,e.ɵa=o,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=angular-draggable-droppable.umd.min.js.map